<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.library.mapper.mylib.ReadingRoom2Mapper">

	<!--  열람실 새롭게 고친거 -->
	<select id="list_all" resultType="com.library.model.mylib.ReadingRoomDTO">
		select * 
	 	  from reading_room where seat_no &gt; 54 and seat_no &lt; 97
		 order by seat_no;
	</select>
	
	<!-- 예약 좌석 정보 -->
	<select id="room2_info" resultType="com.library.model.mylib.ReadingRoomDTO">
		select * 
		from reading_room
		where user_id = #{user_id}		 
	</select>

	<!-- 좌석 예약 -->
	<update id="room2_booking">
		update reading_room
		   set user_id = #{user_id}, checkin_time = current_timestamp , checkout_time = date_add(current_timestamp, INTERVAL 3 HOUR)
	     where seat_no = #{seat_no}
	</update>

	<!-- 좌석 반납&퇴실 -->
	<update id="room2_delete">
		update reading_room
		   set user_id = null, checkin_time = null, checkout_time = null
	     where user_id = #{user_id}
	</update>
	
	<!-- 좌석 연장 -->
	<update id="room2_extend">
		update reading_room 
		   set checkout_time = date_add(checkout_time, interval 2 hour) 
		 where user_id = #{user_id}  
	</update>
	
	<!-- 좌석 이동 -->
	<update id="moveSeat2">
		update reading_room set seat_no =#{seat_no} where seat_no = #{seat_no} 
	</update>

	<!-- 좌석 상태 체크 -->
	<select id="seat2_check" resultType="int">
		select count(*) 
		  from reading_room
		 where seat_no = #{seat_no} and user_id is null 
	</select>
	
	
	
	
	
	 <!-- 사용 가능 좌석 -->
	 <select id="rd2UsingSeat" resultType="int">
	   select count(*) - (select count(*) from reading_room where seat_status = 0)
	      from reading_room
	 </select>
	   
	 <!-- 사용 중인 좌석 -->
	 <select id="rd2UsedSeat" resultType="int">
	   	select count(*) from reading_room2 where seat_status = 0
	 </select>
		
	
	<!-- 열람실 좌석 insert -->
	<insert id="insert">
		insert into reading_room values(#{seat_no}, null, null, null);
	</insert>

</mapper>